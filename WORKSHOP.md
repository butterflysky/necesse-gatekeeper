# GateKeeper — Server Whitelist & Access Control for Necesse

Note: This file is a helper draft for Steam Workshop upload. Copy/paste relevant sections into the in-game uploader when publishing.

## TL;DR
- Server‑side whitelist using SteamID (auth‑only). No client mod needed.
- Prevent griefing; only approved SteamIDs can connect when enabled.
- Easy admin workflow: `/whitelist enable`, then have players connect once and `/whitelist approve-last`.
- Emergency lockdown mode and rate‑limited notices.
- Back up your world before enabling.

Strongly recommended: Back up your world before enabling the whitelist for the first time. Turning on a whitelist without entries can lock out players (and you) until SteamIDs are added.

## Overview
GateKeeper adds an auth‑only (SteamID64) whitelist to Necesse dedicated servers. It helps prevent griefing, limits access to trusted players, and gives server admins a simple, reliable workflow.

- Server‑side mod (clients do not need it)
- Auth‑only enforcement (SteamID64) — names are never used for access
- Fast admin workflow with minimal friction

## Key Features
- Auth‑only whitelist with per‑world config next to your save
- Lockdown mode for emergencies (allow only whitelisted; suppress notifications)
- Admin anti‑noise (rate‑limited connect notices)
- Recent denied attempts view + one‑command approval
- Audit logs for denied connects and admin kicks

## Commands (Admin)
- `/whitelist enable|disable|status` — toggle/inspect whitelist
- `/whitelist reload` — reload config from disk; on parse error, keeps current settings and renames the broken file for review
- `/whitelist lockdown [on|off|status]` — emergency mode
- `/whitelist list` — list whitelisted SteamIDs (shows last‑known names when available)
- `/whitelist online` — show currently connected players (SteamIDs)
- `/whitelist recent` — show recent denied attempts
  - `/whitelist recent approve <index>` — approve a specific attempt
  - `/whitelist approve-last` — approve the most recent attempt
- `/whitelist add <auth|name>` — add by SteamID; names resolve to SteamID if the player is online or saved
- `/whitelist remove <auth|name>` — remove; kicks connected player and logs the action
- `/whitelist export` — write saved players (SteamID,name) to `known_players.txt`

Notes:
- Default is disabled. Enable explicitly with `/whitelist enable`.
- Adding by name only works if the player is online or has played on this world before.
- Recommended workflow: have a new player connect once, then use `/whitelist approve-last`.

## Configuration & Logs (Per‑World)
- Directory world: `<worldDir>/GateKeeper/`
- Zip world: `<parent>/<worldName>.GateKeeper/`
- Files:
  - `whitelist.json` (auth‑only):
    ```json
    {
      "enabled": true,
      "lockdown": false,
      "auth": [76561198000000000, 76561198000000001, 76561198000000002]
    }
    ```
  - `denied_log.txt`: timestamped denied connect attempts
  - `admin_log.txt`: timestamped admin actions (e.g., kicks on removal)
  - `known_players.txt`: generated by `/whitelist export`

## Best Practices
- Back up your world before enabling the whitelist.
- Add at least the server owner’s SteamID first to avoid locking yourself out.
- Use lockdown during incidents; disable when resolved.
- Approve new players via `/whitelist recent` or `/whitelist approve-last`.

## Compatibility
- Server‑side only (clients do not need the mod).
- Built for Java 17 (Necesse bundles JRE 17).

## Source & Issues
- GitHub: https://github.com/butterflysky/necesse-gatekeeper
- Please include server logs and your `GateKeeper/` files when reporting issues.
